var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},__decorate=this&&this.__decorate||function(a,b,c,d){var e,f=arguments.length,g=3>f?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(3>f?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g},codex;!function(a){var b;!function(b){var c=a.util.defined,d=a.util.create,e=function(e){function f(b,c){void 0===b&&(b=""),void 0===c&&(c="master"),e.call(this,a.config("apiUrl")),this.ref=null,this.entities={},this.sources={},this.docs={},this.project=b,this.ref=c}return __extends(f,e),f.prototype.setProject=function(a){this.project=a,this.entities={}},f.prototype.setRef=function(a){this.ref=a,this.entities={}},f.prototype.entitiy=function(f){var g=d();return a.config("debug")===!1&&c(this.entities[f])?g.resolve(this.entities[f]):e.prototype.get.call(this,["phpdoc",this.project,this.ref,"entity"].join("/"),{entity:f}).then(function(a){return g.resolve(b.Entity.make(a.data))}),g.promise},f.prototype.method=function(f){var g=d();return a.config("debug")===!1&&c(this.entities[f])?g.resolve(this.entities[f]):e.prototype.get.call(this,["phpdoc",this.project,this.ref,"entity"].join("/"),{entity:f}).then(function(a){return g.resolve(b.Entity.make(a.data))}),g.promise},f.prototype.list=function(a){void 0===a&&(a=!1);var b=d();return e.prototype.get.call(this,["phpdoc",this.project,this.ref,"list"].join("/"),{full:a}).then(function(a){return b.resolve(a.data)}),b.promise},f.prototype.tree=function(a){void 0===a&&(a=!1);var b=d();return e.prototype.get.call(this,["phpdoc",this.project,this.ref,"tree"].join("/"),{full:a}).then(function(a){return b.resolve(a)}),b.promise},f.prototype.source=function(b){var f=this,g=d();return a.config("debug")===!1&&c(this.sources[b])?g.resolve(this.sources[b]):e.prototype.get.call(this,["phpdoc",this.project,this.ref,"source"].join("/"),{entity:b}).then(function(a){f.sources[b]=a.data.source,g.resolve(a.data.source)}),g.promise},f.prototype.doc=function(b){var f=this,g=d();return a.config("debug")===!1&&c(this.docs[b])?g.resolve(this.docs[b]):e.prototype.get.call(this,["phpdoc",this.project,this.ref,"doc"].join("/"),{entity:b}).then(function(a){f.docs[b]=a.data.doc,g.resolve(a.data.doc)}),g.promise},f}(a.Api);b.PhpdocApi=e}(b=a.phpdoc||(a.phpdoc={}))}(codex||(codex={}));var codex;!function(a){var b;!function(a){var b=function(){function a(a){this.e=a,this.typeIcon=this.getTypeIcon(),this.link=this.getLink()}return a.prototype.getLink=function(){return window.location.pathname+"#!/"+this.e.full_name},a.prototype.getTypeIcon=function(){switch(this.e.type){case"class":return"fa fa-file-code-o color-green-500";case"interface":return"fa fa-code color-purple-800";case"trait":return"fa fa-terminal color-blue-500"}return""},a.make=function(b){return new a(b)},a.prototype.getClassLink=function(){return""},a}();a.Entity=b}(b=a.phpdoc||(a.phpdoc={}))}(codex||(codex={}));var codex;!function(a){var b;!function(b){var c=function(){function c(){this._list=[],this._tree={}}return c.prototype.init=function(c,d){var e=this;return void 0===c&&(c=""),void 0===d&&(d="master"),this._api=new b.PhpdocApi(c,d),this.defer=a.util.create(),async.parallel([function(a){return e.api.list().then(function(b){e._list=b,a()})},function(a){return e.api.tree().then(function(b){e._tree=b.data,a()})}],function(){e.defer.resolve()}),this},c.prototype.ready=function(a){return this.defer.promise.then(a)},Object.defineProperty(c.prototype,"project",{get:function(){return this._api.project},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ref",{get:function(){return this._api.ref},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tree",{get:function(){return this._tree},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"api",{get:function(){return this._api},enumerable:!0,configurable:!0}),c.prototype.initLinks=function(){var a={trigger:"hover",html:!0,viewport:"body",container:"body",placement:"top"},b=$(".phpdoc-link");b.tooltip(_.merge(a,{template:'<div class="tooltip tooltip-phpdoc" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}));var c=$(".phpdoc-popover-link");c.popover(_.merge(a,{template:'<div class="popover popover-phpdoc" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}))},c.prototype.classLink=function(a){return window.location.pathname+"#!/"+a},c.prototype.makeTypeLink=function(b){var c=this,d=[];return b.toString().split("|").forEach(function(b){var e=-1!==b.indexOf("\\");if(e){var f=_.find(c._list,{full_name:b}),g=$("<a>").text(b.split("\\").reverse()[0]).addClass("type-link").attr("title",b);a.util.defined(f)&&(g.addClass("local"),g.attr("href",c.classLink(b))),d.push(g.get(0).outerHTML)}else d.push($("<span>").text(b).addClass("simple-type simple-type-"+b.toLowerCase()).get(0).outerHTML)}),d.join(" | ")},c.prototype.methodCallsign=function(a){var b=a.visibility;return a["abstract"]&&(b="abstract "+b),a["final"]&&(b+=" final"),a["static"]&&(b+=" static"),b},c.prototype.removeValues=function(a){for(var b,c,d=arguments,e=d.length;e>1&&a.length;)for(b=d[--e];-1!==(c=a.indexOf(b));)a.splice(c,1);return a},c}();b.PhpdocHelper=c,jQuery.extend({phpdoc:new c})}(b=a.phpdoc||(a.phpdoc={}))}(codex||(codex={}));var codex;!function(a){var b;!function(b){var c=function(b){function c(){b.call(this),this.widgetEventPrefix="phpdoc",this.options={project:"",ref:"master",defaultClass:null,styleClasses:{container:"phpdoc",tree:"phpdoc-tree",content:"phpdoc-content"},jstree:{plugins:["types","search","wholerow"],core:{themes:{responsive:!1,name:"codex"}},types:{"default":{icon:"fa fa-file"},folder:{icon:"fa fa-folder color-blue-grey-500"},"class":{icon:"fa fa-file-code-o color-green-500"},"interface":{icon:"fa fa-code color-purple-800"},trait:{icon:"fa fa-terminal color-blue-500"}}}},this.history=[],this.ignoreTreeSelect=!1}return __extends(c,b),c.prototype.$=function(a){return this.element.find(a)},c.prototype._create=function(){var b=this;a.config("debug")&&(window.widget=this),this.$el=this.element,this.data={list:[],tree:{},entities:[]},this.$el.html(""),this.$el.ensureClass(this.options.styleClasses.container),this.$tree=$("<div>").addClass(this.options.styleClasses.tree).appendTo(this.$el),this.$treeRoot=$("<ul>").appendTo(this.$tree),this.$content=$("<div>").addClass(this.options.styleClasses.content).appendTo(this.$el),a.startLoader(this.$content),$.phpdoc.init(this.options.project,this.options.ref),this.api=$.phpdoc.api,$.phpdoc.ready(function(){b.data.list=$.phpdoc.list,b.data.tree=$.phpdoc.tree,a.stopLoader(b.$content),b._createTree();var c;c=-1!==location.hash.indexOf("#!/")?location.hash.replace(/\#\!\//,""):null!==b.options.defaultClass?b.options.defaultClass:b.data.list[0].full_name,window.history.replaceState(null,c,window.location.pathname+"#!/"+c),window.addEventListener("popstate",function(a){console.log("popstate",window.location),-1!==location.hash.indexOf("#!/")&&b.open(location.hash.replace(/\#\!\//,""))},!1),b.open(c),b._bindTreeListener()})},c.prototype._createTree=function(){this._traverseTree(this.data.tree,this.$treeRoot,0),this.$tree.jstree(this.options.jstree),this.tree=this.$tree.jstree()},c.prototype._bindTreeListener=function(){var b=this;this.$tree.on("select_node.jstree",this,function(c,d){if(!b.ignoreTreeSelect)if(a.debug.log("select_node.jstree",d),a.debug.log("Selected type",d.node.type),"folder"===d.node.type)b.tree.open_node(d.node);else{var e=d.node.data.fullName;b.open(e),window.history.pushState(null,e,window.location.pathname+"#!/"+e)}})},c.prototype.open=function(b){var c=this;a.startLoader(this.$content),this.$(".type-link").tooltip("hide"),this.api.doc(b).then(function(d){a.stopLoader(c.$content),c.$content.html(d),c.$(".type-link, .visibility-icon").tooltip({viewport:"body",container:"body"}),Prism.highlightAll(),c.openTreeTo(b)}).otherwise(function(a){console.error(a)})},c.prototype._traverseTree=function(a,b,c){for(var d in a){var e=a[d];if(isNaN(parseInt(d))){var f=$("<ul>"),g=$("<li>").text(d).append(f);g.addClass("fs-12"),0==c?g.attr("data-jstree",'{ "opened" : true, "type" : "folder" }'):g.attr("data-jstree",'{ "type" : "folder" }');var h="\\"+d;"undefined"!=typeof b.closest("li").attr("data-full-name")&&(h=b.closest("li").attr("data-full-name")+h),g.attr("data-full-name",h),b.prepend(g),this._traverseTree(e,f,c++)}else b.append($("<li>").text(e.name).attr("data-jstree",'{ "type": "'+e.type+'" }').attr("data-full-name",e.full_name))}},c.prototype.searchTree=function(b){var c=this.tree.get_json(null,{flat:!0});a.debug.log("search for",b,"in",c);var d=!1;return c.forEach(function(c){return"undefined"!=typeof c.data.fullName&&c.data.fullName==b?(a.debug.log("search for",b,"found",c),d=c,!1):void 0}),d},c.prototype.openTreeTo=function(a){var b=this.searchTree(a);b!==!1&&(this.ignoreTreeSelect=!0,this.tree.close_all(),this.tree._open_to(b),this.tree.deselect_all(),this.tree.select_node(b),this.ignoreTreeSelect=!1)},c.prototype._destroy=function(){a.debug.log("destroy")},c=__decorate([a.util.widget("phpdoc")],c)}(a.util.Widget);b.PhpdocWidget=c}(b=a.phpdoc||(a.phpdoc={}))}(codex||(codex={}));var codex;!function(a){var b;!function(a){function b(a){void 0===a&&(a={})}a.helper=new a.PhpdocHelper,a.init=b}(b=a.phpdoc||(a.phpdoc={}))}(codex||(codex={}));